---
const currentPath = Astro.url.pathname;

const primaryLinks = [
  { href: "/", label: "Home" },
  { href: "/map", label: "Map" },
  { href: "/calendar", label: "Calendar" },
  { href: "/explore", label: "Explore" },
  { href: "/news", label: "News" },
];

const learnLinks = [
  { href: "/learn/how-congress-works", label: "How Congress Works" },
  { href: "/senate", label: "2026 Senate Races" },
  { href: "/house", label: "2026 House Races" },
];

const moreLinks = [
  { href: "/glossary", label: "Glossary" },
  { href: "/resources", label: "Resources" },
  { href: "/about", label: "About" },
];

const isLearnActive =
  learnLinks.some(
    (link) => currentPath === link.href || currentPath.startsWith(link.href + "/")
  ) || currentPath.startsWith("/learn/");

const isMoreActive = moreLinks.some(
  (link) => currentPath === link.href || currentPath.startsWith(link.href + "/")
);
---

<header class="bg-navy text-white sticky top-0 z-50">
  <nav class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/" class="text-xl font-bold tracking-tight">
      The Midterm Project
    </a>

    <!-- Desktop nav -->
    <ul class="hidden md:flex gap-6 text-sm font-medium items-center">
      <!-- Home -->
      <li>
        <a
          href="/"
          class:list={[
            "hover:text-tossup transition-colors",
            currentPath === "/" ? "text-tossup" : "text-white/80",
          ]}
        >
          Home
        </a>
      </li>

      <!-- Learn dropdown -->
      <li class="relative">
        <button
          id="learn-btn"
          class:list={[
            "hover:text-tossup transition-colors flex items-center gap-1",
            isLearnActive ? "text-tossup" : "text-white/80",
          ]}
        >
          Learn
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <ul
          id="learn-menu"
          class="hidden absolute left-0 top-full mt-2 bg-navy border border-white/10 rounded-lg py-2 min-w-[200px] shadow-lg"
        >
          {learnLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class:list={[
                  "block px-4 py-2 text-sm hover:text-tossup hover:bg-white/5 transition-colors",
                  currentPath === link.href || currentPath.startsWith(link.href + "/")
                    ? "text-tossup"
                    : "text-white/80",
                ]}
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </li>

      <!-- Map, Explore, News -->
      {primaryLinks.filter((l) => l.href !== "/").map((link) => (
        <li>
          <a
            href={link.href}
            class:list={[
              "hover:text-tossup transition-colors",
              currentPath === link.href || currentPath.startsWith(link.href + "/")
                ? "text-tossup"
                : "text-white/80",
            ]}
          >
            {link.label}
          </a>
        </li>
      ))}

      <!-- More dropdown -->
      <li class="relative">
        <button
          id="more-btn"
          class:list={[
            "hover:text-tossup transition-colors flex items-center gap-1",
            isMoreActive ? "text-tossup" : "text-white/80",
          ]}
        >
          More
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <ul
          id="more-menu"
          class="hidden absolute right-0 top-full mt-2 bg-navy border border-white/10 rounded-lg py-2 min-w-[160px] shadow-lg"
        >
          {moreLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class:list={[
                  "block px-4 py-2 text-sm hover:text-tossup hover:bg-white/5 transition-colors",
                  currentPath === link.href || currentPath.startsWith(link.href + "/")
                    ? "text-tossup"
                    : "text-white/80",
                ]}
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </li>
    </ul>

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden text-white/80 hover:text-white"
      aria-label="Toggle menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile nav -->
  <ul id="mobile-menu" class="hidden md:hidden px-4 pb-4 space-y-1 text-sm font-medium">
    {/* Primary links */}
    {primaryLinks.map((link) => (
      <li>
        <a
          href={link.href}
          class:list={[
            "block py-2 hover:text-tossup transition-colors",
            currentPath === link.href || currentPath.startsWith(link.href + "/")
              ? "text-tossup"
              : "text-white/80",
          ]}
        >
          {link.label}
        </a>
      </li>
    ))}

    {/* Learn section */}
    <li class="pt-3 pb-1 text-xs text-white/30 uppercase tracking-wider">Learn</li>
    {learnLinks.map((link) => (
      <li>
        <a
          href={link.href}
          class:list={[
            "block py-2 hover:text-tossup transition-colors pl-2",
            currentPath === link.href || currentPath.startsWith(link.href + "/")
              ? "text-tossup"
              : "text-white/80",
          ]}
        >
          {link.label}
        </a>
      </li>
    ))}

    {/* More section */}
    <li class="pt-3 pb-1 text-xs text-white/30 uppercase tracking-wider">More</li>
    {moreLinks.map((link) => (
      <li>
        <a
          href={link.href}
          class:list={[
            "block py-2 hover:text-tossup transition-colors pl-2",
            currentPath === link.href || currentPath.startsWith(link.href + "/")
              ? "text-tossup"
              : "text-white/80",
          ]}
        >
          {link.label}
        </a>
      </li>
    ))}
  </ul>
</header>

<script>
  // Mobile menu toggle
  const mobileBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  mobileBtn?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });

  // Desktop "Learn" dropdown
  const learnBtn = document.getElementById("learn-btn");
  const learnMenu = document.getElementById("learn-menu");

  learnBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    learnMenu?.classList.toggle("hidden");
    moreMenu?.classList.add("hidden");
  });

  learnMenu?.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // Desktop "More" dropdown
  const moreBtn = document.getElementById("more-btn");
  const moreMenu = document.getElementById("more-menu");

  moreBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    moreMenu?.classList.toggle("hidden");
    learnMenu?.classList.add("hidden");
  });

  moreMenu?.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // Close all dropdowns when clicking outside
  document.addEventListener("click", () => {
    learnMenu?.classList.add("hidden");
    moreMenu?.classList.add("hidden");
  });
</script>
