---
import Layout from "../../layouts/Layout.astro";
import { fetchHouseOverview } from "../../lib/queries";

const houseOverview = await fetchHouseOverview();
---

<Layout title="House" description="How the U.S. House of Representatives works, plus the current balance of power.">
  <section class="max-w-5xl mx-auto py-16 px-4">
    <h1 class="text-3xl md:text-4xl font-bold mb-2">The U.S. House</h1>
    <p class="text-lg text-slate-500 mb-10">
      All {houseOverview.totalSeats} seats contested every cycle. Currently {houseOverview.currentSplit.republican}R - {houseOverview.currentSplit.democrat}D.
    </p>

    <!-- Path to Majority -->
    <div class="bg-slate-50 rounded-xl p-6 mb-10">
      <h2 class="text-xl font-bold mb-4">Path to Majority</h2>
      <div class="flex items-center mb-4 rounded-full overflow-hidden h-8">
        <div class="bg-gop h-full flex items-center justify-center text-white text-sm font-bold" style={`width: ${(houseOverview.currentSplit.republican / houseOverview.totalSeats) * 100}%`}>
          {houseOverview.currentSplit.republican} R
        </div>
        <div class="bg-dem h-full flex items-center justify-center text-white text-sm font-bold" style={`width: ${(houseOverview.currentSplit.democrat / houseOverview.totalSeats) * 100}%`}>
          {houseOverview.currentSplit.democrat} D
        </div>
      </div>
      <p class="text-sm text-slate-500 text-center">{houseOverview.majorityNeeded} seats needed for majority</p>
      <div class="grid grid-cols-2 gap-4 text-center text-sm mt-4">
        <div>
          <span class="font-bold text-dem text-lg">{houseOverview.demsNeedToFlip}</span>
          <p class="text-slate-500">seats Dems need to flip</p>
        </div>
        <div>
          <span class="font-bold text-gop text-lg">{houseOverview.gopsCanLose}</span>
          <p class="text-slate-500">max seats GOP can lose</p>
        </div>
      </div>
    </div>

    <!-- Key Facts -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-tossup mb-1">{houseOverview.battlegroundDistricts}</div>
        <div class="text-sm font-medium text-slate-500">Battleground Districts</div>
        <p class="text-xs text-slate-400 mt-2">
          {houseOverview.battlegroundBreakdown.democratHeld} Dem-held, {houseOverview.battlegroundBreakdown.republicanHeld} GOP-held
        </p>
      </div>
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-slate-700 mb-1">{houseOverview.retirements.total}</div>
        <div class="text-sm font-medium text-slate-500">Incumbents Retiring</div>
        <p class="text-xs text-slate-400 mt-2">
          {houseOverview.retirements.democrat} Democrats, {houseOverview.retirements.republican} Republicans
        </p>
      </div>
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-slate-700 mb-1">{houseOverview.termLength} yrs</div>
        <div class="text-sm font-medium text-slate-500">Term Length</div>
        <p class="text-xs text-slate-400 mt-2">Every seat, every cycle</p>
      </div>
    </div>

    <!-- Explainer -->
    <div class="bg-slate-900 text-white rounded-xl p-6 mb-10">
      <p class="text-sm leading-relaxed">
        All 435 seats are up every two years &mdash; but most are safe for one party.
        About <strong>{houseOverview.battlegroundDistricts} districts</strong> are where the outcome is actually in play.
        These are the races that will determine who controls the House.
      </p>
    </div>

    <!-- Explore races CTA -->
    <div class="bg-slate-50 rounded-xl p-6 mb-10 text-center">
      <h2 class="text-xl font-bold mb-2">Find your district's race</h2>
      <p class="text-sm text-slate-500 mb-4">
        Use the interactive map to preview your ballot, or find your district's candidates.
      </p>
      <div class="flex flex-wrap gap-3 justify-center">
        <a href="/map" class="inline-flex items-center px-5 py-2.5 bg-navy text-white rounded-lg text-sm font-medium hover:bg-slate-700 transition-colors">
          Interactive Map &rarr;
        </a>
        <a href="/find-your-ballot" class="inline-flex items-center px-5 py-2.5 border border-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors">
          Find Your Ballot &rarr;
        </a>
      </div>
    </div>

    <!-- About House Elections (from current page) -->
    <div class="space-y-6">
      <h2 class="text-2xl font-bold">How House Elections Work</h2>
      <p class="text-slate-600">
        Unlike the Senate, <strong>every single House seat</strong> is up for election in every cycle. Representatives serve 2-year terms, making them the most directly accountable to voters.
      </p>

      <h2 class="text-2xl font-bold">Why the Margins Matter</h2>
      <p class="text-slate-600">
        The current Republican majority is razor-thin. With {houseOverview.currentSplit.republican} seats to {houseOverview.currentSplit.democrat},
        a shift of just a few seats could change who controls the House &mdash; and with it, which bills make it to the floor, which investigations happen, and how the federal budget is shaped.
      </p>

      <h2 class="text-2xl font-bold">Retirements Create Opportunities</h2>
      <p class="text-slate-600">
        {houseOverview.retirements.total} incumbents are not seeking re-election, creating open seats that are often more competitive.
        Incumbents win re-election over 90% of the time, so open seats are where the action is.
      </p>
    </div>

    <!-- ═══════════════════════════════════════ -->
    <!-- House 101 — Evergreen educational content -->
    <!-- ═══════════════════════════════════════ -->

    <div id="101" class="border-t border-slate-200 pt-10 mt-12">
      <h2 class="text-2xl md:text-3xl font-bold mb-6">House 101</h2>

      <div class="space-y-8 max-w-3xl">
        <p class="text-lg text-slate-600">
          The House of Representatives is the "people's chamber." Unlike the Senate, where every state gets two seats, House seats are distributed based on population. More people = more representatives.
        </p>

        <h3 class="text-2xl font-bold">Why Every Seat, Every Time?</h3>
        <p class="text-slate-600">
          With only 2-year terms, House members are <strong>always</strong> up for re-election. This is by design &mdash; the founders wanted the House to be the most responsive to the will of the people. If voters are unhappy, they can replace their representative every two years.
        </p>

        <h3 class="text-2xl font-bold">How Are Seats Distributed?</h3>
        <p class="text-slate-600">
          Every 10 years, after the census, seats are <strong>reapportioned</strong> based on population changes. States that grew may gain seats, while states that shrank may lose them.
        </p>
        <div class="bg-slate-50 rounded-lg p-4">
          <h4 class="font-semibold mb-2">Largest Delegations (2026)</h4>
          <ul class="text-sm text-slate-600 space-y-1">
            <li>California &mdash; 52 seats</li>
            <li>Texas &mdash; 38 seats</li>
            <li>Florida &mdash; 28 seats</li>
            <li>New York &mdash; 26 seats</li>
          </ul>
          <p class="text-xs text-slate-400 mt-2">7 states have only 1 representative: Alaska, Delaware, North Dakota, South Dakota, Vermont, Wyoming, and Montana (gained a 2nd in 2022).</p>
        </div>

        <h3 class="text-2xl font-bold">Districts & Gerrymandering</h3>
        <p class="text-slate-600">
          Each representative serves a specific <strong>district</strong> within their state. State legislatures draw district lines, which can be controversial. <strong>Gerrymandering</strong> is when districts are drawn to favor one party &mdash; it's one of the most debated issues in American politics.
        </p>

        <h3 class="text-2xl font-bold">What Does a Representative Do?</h3>
        <ul class="list-disc list-inside text-slate-600 space-y-2">
          <li>Writes and votes on legislation</li>
          <li>Initiates all revenue (tax) bills &mdash; only the House can do this</li>
          <li>Brings impeachment charges against federal officials</li>
          <li>Represents their district's specific needs and interests</li>
        </ul>
      </div>
    </div>
  </section>
</Layout>
