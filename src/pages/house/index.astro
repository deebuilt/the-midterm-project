---
import Layout from "../../layouts/Layout.astro";
import HouseRaces from "../../components/ui/HouseRaces";
import { fetchHouseOverview, fetchHouseRaces } from "../../lib/queries";

const houseOverview = await fetchHouseOverview();
const houseRaces = await fetchHouseRaces();
---

<Layout title="2026 House Races" description="All 435 House seats are up for election in 2026. See the battleground districts.">
  <section class="max-w-5xl mx-auto py-16 px-4">
    <h1 class="text-3xl md:text-4xl font-bold mb-2">2026 House Races</h1>
    <p class="text-lg text-slate-500 mb-10">
      All {houseOverview.totalSeats} seats contested. Currently {houseOverview.currentSplit.republican}R - {houseOverview.currentSplit.democrat}D.
    </p>

    <!-- Path to Majority -->
    <div class="bg-slate-50 rounded-xl p-6 mb-10">
      <h2 class="text-xl font-bold mb-4">Path to Majority</h2>
      <div class="flex items-center mb-4 rounded-full overflow-hidden h-8">
        <div class="bg-gop h-full flex items-center justify-center text-white text-sm font-bold" style={`width: ${(houseOverview.currentSplit.republican / houseOverview.totalSeats) * 100}%`}>
          {houseOverview.currentSplit.republican} R
        </div>
        <div class="bg-dem h-full flex items-center justify-center text-white text-sm font-bold" style={`width: ${(houseOverview.currentSplit.democrat / houseOverview.totalSeats) * 100}%`}>
          {houseOverview.currentSplit.democrat} D
        </div>
      </div>
      <p class="text-sm text-slate-500 text-center">{houseOverview.majorityNeeded} seats needed for majority</p>
      <div class="grid grid-cols-2 gap-4 text-center text-sm mt-4">
        <div>
          <span class="font-bold text-dem text-lg">{houseOverview.demsNeedToFlip}</span>
          <p class="text-slate-500">seats Dems need to flip</p>
        </div>
        <div>
          <span class="font-bold text-gop text-lg">{houseOverview.gopsCanLose}</span>
          <p class="text-slate-500">max seats GOP can lose</p>
        </div>
      </div>
    </div>

    <!-- Key Facts -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-tossup mb-1">{houseOverview.battlegroundDistricts}</div>
        <div class="text-sm font-medium text-slate-500">Battleground Districts</div>
        <p class="text-xs text-slate-400 mt-2">
          {houseOverview.battlegroundBreakdown.democratHeld} Dem-held, {houseOverview.battlegroundBreakdown.republicanHeld} GOP-held
        </p>
      </div>
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-slate-700 mb-1">{houseOverview.retirements.total}</div>
        <div class="text-sm font-medium text-slate-500">Incumbents Retiring</div>
        <p class="text-xs text-slate-400 mt-2">
          {houseOverview.retirements.democrat} Democrats, {houseOverview.retirements.republican} Republicans
        </p>
      </div>
      <div class="bg-slate-50 rounded-xl p-6 text-center">
        <div class="text-3xl font-bold text-slate-700 mb-1">{houseOverview.termLength} yrs</div>
        <div class="text-sm font-medium text-slate-500">Term Length</div>
        <p class="text-xs text-slate-400 mt-2">Every seat, every cycle</p>
      </div>
    </div>

    <!-- Explainer -->
    <div class="bg-slate-900 text-white rounded-xl p-6 mb-10">
      <p class="text-sm leading-relaxed">
        All 435 seats are up every two years &mdash; but most are safe for one party.
        Below are the <strong>~{houseRaces.length} districts</strong> where the outcome is actually in play.
        These are the races that will determine who controls the House.
      </p>
    </div>

    <!-- Battleground Races -->
    {houseRaces.length > 0 ? (
      <HouseRaces client:load races={houseRaces} />
    ) : (
      <div class="bg-slate-50 border border-slate-200 rounded-lg p-6">
        <p class="text-sm text-slate-500">
          House race data is being loaded. Check back soon, or explore the
          <a href="/senate" class="text-dem underline">Senate races</a> or
          <a href="/whos-running" class="text-tossup underline">see who's running</a>.
        </p>
      </div>
    )}

    <!-- About House Elections -->
    <div class="space-y-6 mt-12">
      <h2 class="text-2xl font-bold">How House Elections Work</h2>
      <p class="text-slate-600">
        Unlike the Senate, <strong>every single House seat</strong> is up for election in every cycle. Representatives serve 2-year terms, making them the most directly accountable to voters.
      </p>

      <h2 class="text-2xl font-bold">Why the Margins Matter</h2>
      <p class="text-slate-600">
        The current Republican majority is razor-thin. With {houseOverview.currentSplit.republican} seats to {houseOverview.currentSplit.democrat},
        a shift of just a few seats could change who controls the House &mdash; and with it, which bills make it to the floor, which investigations happen, and how the federal budget is shaped.
      </p>

      <h2 class="text-2xl font-bold">Retirements Create Opportunities</h2>
      <p class="text-slate-600">
        {houseOverview.retirements.total} incumbents are not seeking re-election, creating open seats that are often more competitive.
        Incumbents win re-election over 90% of the time, so open seats are where the action is.
      </p>
    </div>
  </section>
</Layout>
